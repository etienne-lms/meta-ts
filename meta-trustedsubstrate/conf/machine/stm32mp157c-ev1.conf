#@TYPE: Machine
#@NAME: generic armv7 machine
#@DESCRIPTION: Machine configuration for running a generic armv8

require conf/machine/include/arm/armv7a/tune-cortexa7.inc

MACHINEOVERRIDES =. "stm32mp157c-ev1:"

IMAGE_FSTYPES:remove = "tar.gz"

# TF-A
TFA_PLATFORM = "stm32mp157c-ev1:"
PREFERRED_VERSION_trusted-firmware-a ?= "2.6%"
EXTRA_IMAGEDEPENDS += "trusted-firmware-a"

# optee
EXTRA_IMAGEDEPENDS += "optee-os"
OPTEE_ARCH = "arm32"
OPTEE_BINARY = "tee-pager_v2.bin"

# u-boot
PREFERRED_VERSION_u-boot ?= "2021.10"
EXTRA_IMAGEDEPENDS += "u-boot"
UBOOT_CONFIG ??= "EFI"
UBOOT_CONFIG[EFI] = "stm32mp157c_ev1_trusted_defconfig"
#UBOOT_ENTRYPOINT  = "0x80000000"
#UBOOT_LOADADDRESS = "0x80000000"
#UBOOT_BOOTARGS = "earlycon=pl011,0x1a510000 console=ttyAMA0 loglevel=9"
UBOOT_ARCH = "arm"
UBOOT_EXTLINUX = "0"

SERIAL_CONSOLES ?= "115200;ttyAMA0"
SERIAL_CONSOLES_CHECK = "${SERIAL_CONSOLES}"

#WIC
IMAGE_FSTYPES += "wic"
WKS_FILE ?= "stm32mp157c-ev1.wks.in"
WKS_FILE_DEPENDS += "trusted-firmware-a"
