From 608d9fb3f1bf2779fd53cdf7484f0f7f958f4aba Mon Sep 17 00:00:00 2001
From: Masahisa Kojima <masahisa.kojima@linaro.org>
Date: Tue, 16 Nov 2021 15:39:36 +0900
Subject: [PATCH] synquacer: add fTPM support

Signed-off-by: Masahisa Kojima <masahisa.kojima@linaro.org>
---
 arch/arm/dts/synquacer-sc2a11.dtsi       |  5 ++++-
 configs/synquacer_developerbox_defconfig | 21 +++++++++++++++++++++
 2 files changed, 25 insertions(+), 1 deletion(-)

diff --git a/arch/arm/dts/synquacer-sc2a11.dtsi b/arch/arm/dts/synquacer-sc2a11.dtsi
index 1fe7d214b9..1372c8f779 100644
--- a/arch/arm/dts/synquacer-sc2a11.dtsi
+++ b/arch/arm/dts/synquacer-sc2a11.dtsi
@@ -587,9 +587,12 @@
         optee {
             compatible = "linaro,optee-tz";
             method = "smc";
-            status = "disabled";
         };
     };
+
+    tpm@0 {
+        compatible = "microsoft,ftpm";
+    };
 };
 
 #include "synquacer-sc2a11-caches.dtsi"
diff --git a/configs/synquacer_developerbox_defconfig b/configs/synquacer_developerbox_defconfig
index 13736a4f03..429576c146 100644
--- a/configs/synquacer_developerbox_defconfig
+++ b/configs/synquacer_developerbox_defconfig
@@ -93,3 +93,24 @@ CONFIG_EFI_CAPSULE_ON_DISK=y
 CONFIG_EFI_IGNORE_OSINDICATIONS=y
 CONFIG_EFI_CAPSULE_FIRMWARE_RAW=y
 CONFIG_EFI_SECURE_BOOT=y
+CONFIG_TEE=y
+CONFIG_CMD_TPM_V2=y
+CONFIG_CMD_TPM=y
+CONFIG_TPM_V2=y
+CONFIG_TPM2_FTPM_TEE=y
+CONFIG_TPM=y
+CONFIG_CMD_MMC_RPMB=y
+CONFIG_CMD_OPTEE_RPMB=y
+CONFIG_SUPPORT_EMMC_RPMB=y
+CONFIG_OPTEE=y
+CONFIG_OPTEE_TA_AVB=y
+CONFIG_CHIMP_OPTEE=y
+CONFIG_OPTEE_LOAD_ADDR=0x00000000fc000000
+CONFIG_OPTEE_TZDRAM_SIZE=0x00000003c00000
+CONFIG_OPTEE_TZDRAM_BASE=0x00000000fc000000
+CONFIG_SHA1=y
+CONFIG_SHA256=y
+CONFIG_SHA512_ALGO=y
+CONFIG_SHA512=y
+CONFIG_SHA384=y
+CONFIG_MD5=y
-- 
2.17.1

