This directory contains firmware reference images for SystemReady IR
certification.

==========================
Images for STM32MP157C-EV1
==========================

File *ts-firmware-stm32mp157c-ev1.wic.gz*
*****************************************

This file is a raw GPT partitioned image for STM32MP157C-EV1 board, in a
compressed form. It contains the boot firmware images for SR-IR v1.0
certification. This image is also suitable to board STM32MP157F-EV1.
You can program a SDcard with the image using a command like the below
where /dev/sdX related to your SDcard system device file:

.. code-block:: bash

  $ zcat ts-firmware-stm32mp157c-ev1.wic.gz | dd conv=fdatasync of=/dev/sdX

Once the SDcard is programmed, it is recommended to relocate the backup GPT
table using for example **sgdisk** tool:

.. code-block:: bash

  $ sgdisk -e /dev/sdX

Warning:
This image will attempt to programm the RPMB key of the board eMMC device
with OP-TEE test key (``CFG_RPMB_TESTKEY=y``). To prevent OP-TEE attempting
form writing a RPMB key in your device, you must disable ``CFG_RPMB_WRITE_KEY``
(``CFG_RPMB_WRITE_KEY=n``) in **meta-trustedsubstrate** recipe
**optee/optee-os-stm32mp157c-ev1.inc** and rebuild **ci/stm32mp157c-ev1.yml**
firmware image as showed below. Check OP-TEE configuration for an alternate
RPMB key.

OP-TEE RPMB test key can be found in optee_os source tree, refer to
``CFG_RPMB_TESTKEY``. Below is OP-TEE test key byte value:
    0xD3, 0xEB, 0x3E, 0xC3, 0x6E, 0x33, 0x4C, 0x9F,
    0x98, 0x8C, 0xE2, 0xC0, 0xB8, 0x59, 0x54, 0x61,
    0x0D, 0x2B, 0xCF, 0x86, 0x64, 0x84, 0x4D, 0xF2,
    0xAB, 0x56, 0xE6, 0xC6, 0x1B, 0xB7, 0x01, 0xE4.

You can rebuild fhe firmware image from meta-ts layer with **kas** tool using
**ci/stm32mp157c-ev1.yml** project:

.. code-block:: bash

  $ kas build ci/stm32mp157c-ev1.yml

Firmware image in generated image at path
**build/tmp/deploy/images/stm32mp157c-ev1/**.


File *capsule-fip-stm32mp157c-ev1.bin*
**************************************

This file is an example of a EFI capsule file demonstrating U-BOOT/OP-TEE
firmwares update on STM32MP15C-EV1 for SR-IR v1.0 certification.

Capsule file is generated by processing STM32MP15C-EV1 FIP boot image file
**fip.bin** with mkeficapsule tool from U-Boot component. The capsule shall
identify the contained image using GUID for STM32MP1 series and specifying
image index 1:

.. code-block:: bash

  $ mkeficapsule --index 1 --guid 19d5df83-11b0-457b-be2c-7559c13142a5 fip.bin capsule.bin

To distinguish booting with updated firmwares (U-Boot and OP-TEE) from
booting with firmwares installed from the compressed WIC file, OP-TEE and
U-Boot were locally changed to show a build date of Oct 7th 2022 in their
related console banner trace message.

==========================
Images for STM32MP157C-DK2
==========================

File *ts-firmware-stm32mp157c-dk2.wic.gz*
*****************************************

This file is a compress raw GPT partitioned image for STM32MP157C-DK2 board.
It contains the boot firmware images for SR-IR v1.0 certification.
These images are also suitable for STM32MP157F-DK2 board.
You can program a SDcard with the image using a command like the below:

This file is a raw GPT partitioned image for STM32MP157C-DK2 board, in a
compressed form. It contains the boot firmware images for SR-IR v1.0
certification. This image is also suitable to board STM32MP157F-DK2.
You can program a SDcard with the image using a command like the below
where /dev/sdX related to your SDcard system device file:


.. code-block:: bash

  $ zcat ts-firmware-stm32mp157c-dk2.wic.gz | dd conv=fdatasync of=/dev/sdX

Once the SDcard is programmed, it is recommended to relocate the backup GPT
table using for example sgdisk tool:

.. code-block:: bash

  $ sgdisk -e /dev/sdX

You can rebuild fhe firmware image from meta-ts layer with **kas** tool using
**ci/stm32mp157c-dk2.yml** project:

.. code-block:: bash

  $ kas build ci/stm32mp157c-dk2.yml


File *capsule-fip-stm32mp157c-dk2.bin*
**************************************

This file is an example of a EFI capsule file demonstrating U-BOOT/OP-TEE
firmwares update on STM32MP15C-DK2 for SR-IR v1.0 certification.

Capsule file is generated by processing STM32MP15C-DK2 FIP boot image file
**fip.bin** with mkeficapsule tool from U-Boot component. The capsule shall
identify the contained image using GUID for STM32MP1 series and specifying
image index 1:

.. code-block:: bash

  $ mkeficapsule --index 1 --guid 19d5df83-11b0-457b-be2c-7559c13142a5 fip.bin capsule.bin

To distinguish booting with updated firmwares (U-Boot and OP-TEE) from
booting with firmwares installed from the compressed WIC file, OP-TEE and
U-Boot were locally changed to show a build date of Oct 7th 2022 in their
related console banner trace message.
